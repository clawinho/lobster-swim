<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>ü¶û Lobster Swim - Asset Library</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <style>
        * { box-sizing: border-box; margin: 0; padding: 0; }
        body { background: linear-gradient(180deg, #000810 0%, #001020 50%, #001830 100%); min-height: 100vh; font-family: monospace; color: #fff; padding: 20px; }
        header { text-align: center; padding: 30px 0; border-bottom: 1px solid #ff450044; margin-bottom: 30px; }
        header h1 { color: #ff4500; font-size: 2.5em; margin-bottom: 10px; }
        header p { color: #666; font-size: 0.9em; }
        .version-tabs { display: flex; gap: 0; border-bottom: 1px solid #ff450033; }
        .version-tab { padding: 8px 14px; font-size: 0.75em; color: #666; cursor: pointer; border: 1px solid transparent; border-bottom: none; background: #000810; margin-bottom: -1px; border-radius: 4px 4px 0 0; }
        .version-tab:hover { color: #ff4500; background: #ff450011; }
        .version-tab.active { color: #ff4500; background: #001020; border-color: #ff450033; border-bottom-color: #001020; }
        .version-tab .star { color: #ffd700; margin-left: 4px; }
        .nav { display: flex; justify-content: center; gap: 15px; margin-bottom: 40px; flex-wrap: wrap; }
        .nav a { color: #888; text-decoration: none; padding: 8px 16px; border: 1px solid #333; border-radius: 4px; }
        .nav a:hover, .nav a.active { color: #ff4500; border-color: #ff4500; background: #ff450011; }
        .section { display: none; margin-bottom: 50px; }
        .section.active { display: block; }
        .section h2 { color: #ff4500; font-size: 1.4em; margin-bottom: 20px; padding-bottom: 10px; border-bottom: 1px solid #ff450033; }
        .asset-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(320px, 1fr)); gap: 25px; }
        .asset-card { background: #001020; border: 1px solid #ff450033; border-radius: 8px; overflow: hidden; }
        .asset-card:hover { border-color: #ff4500; }
        .asset-preview { background: #000810; height: 180px; display: flex; align-items: center; justify-content: center; }
        .asset-info { padding: 15px; }
        .asset-info h3 { color: #fff; margin-bottom: 8px; }
        .asset-info p { color: #888; font-size: 0.85em; margin-bottom: 12px; }
        .asset-meta { display: flex; gap: 10px; flex-wrap: wrap; margin-bottom: 12px; }
        .tag { font-size: 0.7em; padding: 3px 8px; border-radius: 3px; background: #ff450022; color: #ff4500; }
        .tag.level { background: #4488ff22; color: #4488ff; }
        .controls { display: flex; flex-direction: column; gap: 8px; }
        .control-row { display: flex; align-items: center; gap: 10px; }
        .control-row label { color: #666; font-size: 0.75em; width: 70px; }
        .control-row input[type="range"] { flex: 1; accent-color: #ff4500; }
        .control-row .value { color: #ff4500; font-size: 0.8em; width: 40px; text-align: right; }
        .param-tabs { display: flex; gap: 0; margin-bottom: 8px; border-bottom: 1px solid #333; }
        .param-tab { padding: 4px 12px; font-size: 0.7em; color: #666; cursor: pointer; border: 1px solid transparent; border-bottom: none; background: transparent; border-radius: 3px 3px 0 0; margin-bottom: -1px; }
        .param-tab:hover { color: #ff4500; }
        .param-tab.active { color: #ff4500; background: #ff450011; border-color: #333; border-bottom-color: #001020; }
        .param-pane { display: none; }
        .param-pane.active { display: flex; flex-direction: column; gap: 8px; }
        /* version tabs are at top of cards now */
        /* bottom-nav styles moved to component */
        #toast { position: fixed; bottom: 70px; right: 20px; background: #00ff8833; border: 1px solid #00ff88; color: #00ff88; padding: 10px 20px; border-radius: 6px; opacity: 0; transition: opacity 0.3s; }
        #toast.show { opacity: 1; }
        .audio-btn { background: #ff4500; border: none; color: #000; padding: 8px 20px; border-radius: 20px; cursor: pointer; font-weight: bold; font-size: 14px; }
        .audio-btn:hover { background: #ff6633; transform: scale(1.05); }
        .anim-buttons { display: flex; gap: 4px; }
        .anim-btn { padding: 4px 8px; font-size: 11px; border: 1px solid #555; background: #222; color: #aaa; cursor: pointer; border-radius: 3px; }
        .anim-btn:hover { background: #333; }
        .anim-btn.active { background: #ff6600; color: #000; border-color: #ff6600; }
    </style>
</head>
<body>
    <header><h1>ü¶û Asset Library</h1><p>Modular entity versions ‚Äî use tabs to switch versions</p></header>
    
    <nav class="nav">
        <a href="#characters" class="active">Characters</a>
        <a href="#enemies">Enemies</a>
        <a href="#pickups">Pickups</a>
        <a href="#environments">Environments</a>
        <a href="#mechanics">Mechanics</a>
        <a href="#audio">Audio</a>
    </nav>
    
    <section class="section active" id="characters">
        <h2>ü¶û Characters</h2>
        <div class="asset-grid">
            <div class="asset-card" data-entity="lobster">
                <div class="version-tabs">
                    <span class="version-tab" data-version="001">v001</span>
                    <span class="version-tab" data-version="002">v002</span>
                    <span class="version-tab" data-version="003">v003</span>
                    <span class="version-tab active" data-version="004">v004<span class="star">‚òÖ</span></span>
                </div>
                <div class="asset-preview"><canvas id="lobster-canvas" width="200" height="150"></canvas></div>
                <div class="asset-info">
                    <h3>Lobster</h3><p>Player character with tail physics.</p>
                    <div class="controls">
                        <div class="param-pane active" data-pane="actor" data-actor-key="player">
                            <!-- generated dynamically -->
                        </div>
                    </div>
            </div>
        </div>
    </section>
    
    <section class="section" id="enemies">
        <h2>üíÄ Enemies</h2>
        <div class="asset-grid">
            <div class="asset-card" data-entity="hook">
                <div class="version-tabs">
                    <span class="version-tab" data-version="001">v001</span>
                    <span class="version-tab active" data-version="002">v002<span class="star">‚òÖ</span></span>
                </div>
                <div class="asset-preview"><canvas id="hook-canvas" width="200" height="150"></canvas></div>
                <div class="asset-info">
                    <h3>Hook</h3><p>Pendulum swing hazard.</p>
                    <div class="controls">
                        <div class="param-pane active" data-pane="actor" data-actor-key="hooks">
                            <!-- generated dynamically -->
                        </div>
                    </div>
                </div>
            </div>
            <div class="asset-card" data-entity="cage">
                <div class="version-tabs">
                    <span class="version-tab" data-version="001">v001</span>
                    <span class="version-tab active" data-version="002">v002<span class="star">‚òÖ</span></span>
                </div>
                <div class="asset-preview"><canvas id="cage-canvas" width="200" height="150"></canvas></div>
                <div class="asset-info">
                    <h3>Cage</h3><p>Lobster trap.</p>
                    <div class="controls">
                        <div class="param-pane active" data-pane="actor" data-actor-key="cages">
                            <!-- generated dynamically -->
                        </div>
                    </div>
                </div>
            </div>
            <div class="asset-card" data-entity="net">
                <div class="version-tabs">
                    <span class="version-tab active" data-version="001">v001<span class="star">‚òÖ</span></span>
                </div>
                <div class="asset-preview"><canvas id="net-canvas" width="200" height="150"></canvas></div>
                <div class="asset-info">
                    <h3>Net</h3><p>Level 2 sweeping hazard.</p>
                    <div class="controls">
                        <div class="param-pane active" data-pane="actor" data-actor-key="nets">
                            <!-- generated dynamically -->
                        </div>
                    </div>
                </div>
            </div>
            <div class="asset-card" data-entity="fork">
                <div class="version-tabs">
                    <span class="version-tab active" data-version="001">v001<span class="star">‚òÖ</span></span>
                </div>
                <div class="asset-preview"><canvas id="fork-canvas" width="200" height="150"></canvas></div>
                <div class="asset-info">
                    <h3>Fork</h3><p>Level 3 falling hazard.</p>
                    <div class="controls">
                        <div class="param-tabs">
                            <span class="param-tab" data-pane="render">Render</span>
                            <span class="param-tab active" data-pane="actor">Actor</span>
                        </div>
                        <div class="param-pane" data-pane="render">
                            <div class="control-row"><label>Size</label><input type="range" id="fork-size" min="20" max="60" value="40"><span class="value">40</span></div>
                        </div>
                        <div class="param-pane active" data-pane="actor" data-actor-key="forks">
                            <!-- generated dynamically -->
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>
    
    <section class="section" id="pickups">
        <h2>‚ú® Pickups</h2>
        <div class="asset-grid">
            <div class="asset-card" data-entity="bubble">
                <div class="version-tabs">
                    <span class="version-tab active" data-version="001">v001<span class="star">‚òÖ</span></span>
                    <span class="version-tab" data-version="002">v002</span>
                </div>
                <div class="asset-preview"><canvas id="bubble-canvas" width="200" height="150"></canvas></div>
                <div class="asset-info">
                    <h3>Bubble</h3><p>Collectible. v002 has gradient!</p>
                    <div class="controls">
                        <div class="param-tabs">
                            <span class="param-tab" data-pane="render">Render</span>
                            <span class="param-tab active" data-pane="actor">Actor</span>
                        </div>
                        <div class="param-pane" data-pane="render">
                            <div class="control-row"><label>Color</label>
                                <div class="anim-buttons" data-param="bubbleColor">
                                    <button class="anim-btn active" data-value="blue">Blue</button>
                                    <button class="anim-btn" data-value="pink">Pink</button>
                                    <button class="anim-btn" data-value="green">Green</button>
                                    <button class="anim-btn" data-value="gold">Gold</button>
                                </div>
                            </div>
                        </div>
                        <div class="param-pane active" data-pane="actor" data-actor-key="bubbles">
                            <!-- generated dynamically -->
                        </div>
                    </div>
                </div>
            </div>
            <div class="asset-card" data-entity="fish">
                <div class="version-tabs">
                    <span class="version-tab active" data-version="001">v001<span class="star">‚òÖ</span></span>
                    <span class="version-tab" data-version="002">v002</span>
                </div>
                <div class="asset-preview"><canvas id="fish-canvas" width="200" height="150"></canvas></div>
                <div class="asset-info">
                    <h3>Golden Fish</h3><p>+1 life pickup. v002 has shimmer!</p>
                    <div class="controls">
                        <div class="param-tabs">
                            <span class="param-tab" data-pane="render">Render</span>
                            <span class="param-tab active" data-pane="actor">Actor</span>
                        </div>
                        <div class="param-pane" data-pane="render">
                            <div class="control-row"><label>Shimmer</label><input type="range" id="fish-shimmer" min="0" max="10" value="5"><span class="value">5</span></div>
                        </div>
                        <div class="param-pane active" data-pane="actor" data-actor-key="fish">
                            <!-- generated dynamically -->
                        </div>
                    </div>
                </div>
            </div>
            <div class="asset-card" data-entity="particle">
                <div class="version-tabs">
                    <span class="version-tab active" data-version="001">v001<span class="star">‚òÖ</span></span>
                </div>
                <div class="asset-preview"><canvas id="particle-canvas" width="200" height="150"></canvas></div>
                <div class="asset-info">
                    <h3>Particles</h3><p>Visual effects for collect, death, bonus.</p>
                    <div class="controls">
                        <div class="control-row"><label>Type</label>
                            <select id="particle-type" style="flex:1; background:#001020; color:#fff; border:1px solid #ff450044; padding:4px;">
                                <option value="bubble">Bubble Collect</option>
                                <option value="death">Death Splash</option>
                                <option value="golden">Golden Fish</option>
                            </select>
                        </div>
                        <div class="control-row"><label>Count</label><input type="range" id="particle-count" min="4" max="20" value="8"><span class="value">8</span></div>
                    </div>
                </div>
            </div>
        </div>
    </section>
    
    <section class="section" id="environments">
        <h2>üåä Environments</h2>
        <div class="asset-grid">
            <div class="asset-card" data-entity="ocean">
                <div class="version-tabs">
                    <span class="version-tab active" data-version="v001">v001<span class="star">‚òÖ</span></span>
                </div>
                <div class="asset-preview"><canvas id="ocean-bg" width="200" height="150"></canvas></div>
                <div class="asset-info"><h3>Ocean</h3><p>Level 1 ‚Äî The Ocean</p></div>
            </div>
            <div class="asset-card" data-entity="tank">
                <div class="version-tabs">
                    <span class="version-tab active" data-version="v001">v001<span class="star">‚òÖ</span></span>
                </div>
                <div class="asset-preview"><canvas id="tank-bg" width="200" height="150"></canvas></div>
                <div class="asset-info"><h3>Tank</h3><p>Level 2 ‚Äî Seafood Tank</p></div>
            </div>
            <div class="asset-card" data-entity="kitchen">
                <div class="version-tabs">
                    <span class="version-tab active" data-version="v001">v001<span class="star">‚òÖ</span></span>
                </div>
                <div class="asset-preview"><canvas id="kitchen-bg" width="200" height="150"></canvas></div>
                <div class="asset-info"><h3>Kitchen</h3><p>Level 3 ‚Äî The Kitchen</p></div>
            </div>
        </div>
    </section>

    
    <section class="section" id="mechanics">
        <h2>‚öôÔ∏è Mechanics</h2>
        <div class="asset-grid">
            <div class="asset-card">
                <div class="asset-preview"><canvas id="magnet-canvas" width="200" height="150"></canvas></div>
                <div class="asset-info">
                    <h3>Bubble Magnetism</h3>
                    <p>Bubbles attracted to lobster within radius.</p>
                    <div class="controls">
                        <div class="control-row"><label>Radius</label><input type="range" id="magnet-radius" min="30" max="150" value="80"><span class="value">80</span></div>
                        <div class="control-row"><label>Strength</label><input type="range" id="magnet-strength" min="1" max="10" value="3"><span class="value">3</span></div>
                    </div>
                    <div class="asset-meta"><span class="tag">core</span></div>
                </div>
            </div>
            <div class="asset-card">
                <div class="asset-preview"><canvas id="invincibility-canvas" width="200" height="150"></canvas></div>
                <div class="asset-info">
                    <h3>Invincibility</h3>
                    <p>Golden shield + flash on spawn/damage.</p>
                    <div class="controls">
                        <div class="control-row"><label>Duration</label><input type="range" id="invuln-dur" min="30" max="180" value="120"><span class="value">2s</span></div>
                    </div>
                    <div class="asset-meta"><span class="tag">defensive</span></div>
                </div>
            </div>
            <div class="asset-card">
                <div class="asset-preview"><canvas id="difficulty-canvas" width="200" height="150"></canvas></div>
                <div class="asset-info">
                    <h3>Difficulty Scaling</h3>
                    <p>Speed and enemy count scale with score.</p>
                    <div class="asset-meta"><span class="tag">progression</span></div>
                </div>
            </div>
        </div>
    </section>

    <section class="section" id="audio">
        <h2>üîä Audio</h2>
        <div class="asset-grid">
            <div class="asset-card">
                <div class="asset-preview" style="flex-direction: column; gap: 10px;">
                    <div style="font-size: 48px;">ü´ß</div>
                    <button onclick="Audio.playBloop()" class="audio-btn">‚ñ∂ Bloop</button>
                </div>
                <div class="asset-info"><h3>Bubble Collect</h3><p>Rising pitch sweep.</p></div>
            </div>
            <div class="asset-card">
                <div class="asset-preview" style="flex-direction: column; gap: 10px;">
                    <div style="font-size: 48px;">üí•</div>
                    <button onclick="Audio.playHit()" class="audio-btn">‚ñ∂ Hit</button>
                </div>
                <div class="asset-info"><h3>Damage</h3><p>Sawtooth descend.</p></div>
            </div>
            <div class="asset-card">
                <div class="asset-preview" style="flex-direction: column; gap: 10px;">
                    <div style="font-size: 48px;">üíÄ</div>
                    <button onclick="Audio.playDeath()" class="audio-btn">‚ñ∂ Death</button>
                </div>
                <div class="asset-info"><h3>Game Over</h3><p>Dramatic descend.</p></div>
            </div>
            <div class="asset-card">
                <div class="asset-preview" style="flex-direction: column; gap: 10px;">
                    <div style="font-size: 48px;">‚ù§Ô∏è</div>
                    <button onclick="Audio.playExtraLife()" class="audio-btn">‚ñ∂ Life</button>
                </div>
                <div class="asset-info"><h3>Extra Life</h3><p>Ascending arpeggio.</p></div>
            </div>
            <div class="asset-card">
                <div class="asset-preview" style="flex-direction: column; gap: 10px;">
                    <div style="font-size: 48px;">ü™ù</div>
                    <button onclick="Audio.playHooked()" class="audio-btn">‚ñ∂ Hooked</button>
                </div>
                <div class="asset-info"><h3>Hooked</h3><p>Triangle sweep down.</p></div>
            </div>
            <div class="asset-card">
                <div class="asset-preview" style="flex-direction: column; gap: 10px;">
                    <div style="font-size: 48px;">‚¨ÜÔ∏è</div>
                    <button onclick="Audio.playLevelUp()" class="audio-btn">‚ñ∂ Level Up</button>
                </div>
                <div class="asset-info"><h3>Level Up</h3><p>Triumphant arpeggio.</p></div>
            </div>
            <div class="asset-card">
                <div class="asset-preview" style="flex-direction: column; gap: 10px;">
                    <div style="font-size: 48px;">üåä</div>
                    <button class="audio-btn" data-music="ocean">‚ñ∂ Ocean</button>
                    <audio id="music-ocean" src="../assets/music/music_ocean.mp3" loop></audio>
                </div>
                <div class="asset-info"><h3>Ocean Theme</h3><p>Calm underwater vibes.</p></div>
            </div>
            <div class="asset-card">
                <div class="asset-preview" style="flex-direction: column; gap: 10px;">
                    <div style="font-size: 48px;">üêü</div>
                    <button class="audio-btn" data-music="tank">‚ñ∂ Tank</button>
                    <audio id="music-tank" src="../assets/music/music_tank.mp3" loop></audio>
                </div>
                <div class="asset-info"><h3>Tank Theme</h3><p>Tense aquarium escape.</p></div>
            </div>
            <div class="asset-card">
                <div class="asset-preview" style="flex-direction: column; gap: 10px;">
                    <div style="font-size: 48px;">üç≥</div>
                    <button class="audio-btn" data-music="kitchen">‚ñ∂ Kitchen</button>
                    <audio id="music-kitchen" src="../assets/music/music_kitchen.mp3" loop></audio>
                </div>
                <div class="asset-info"><h3>Kitchen Theme</h3><p>Frantic final level.</p></div>
            </div>
            <div class="asset-card">
                <div class="asset-preview" style="flex-direction: column; gap: 10px;">
                    <div style="font-size: 48px;">üéπ</div>
                    <button class="audio-btn" data-music="groovy">‚ñ∂ Groovy</button>
                    <audio id="music-groovy" src="../assets/music/lobster_jazz_groovy.mp3" loop></audio>
                </div>
                <div class="asset-info"><h3>OG Groovy Jazz</h3><p>Transport Tycoon style bangers (v0.3.2).</p></div>
            </div>
        </div>
    </section>
    <bottom-nav version="1.0.24"></bottom-nav>
    <script type="module" src="../js/components/BottomNav.js"></script>
    <div id="toast"></div>
    
    <script src="../js/audio.js"></script>
    <script type="module">
        import { ENTITY_CONFIG } from '../js/components/EntityInspector.js';
        import { render as lobsterV001 } from '../js/entities/hero/lobster/render/Lobster.v001.js';
        import { render as lobsterV002 } from '../js/entities/hero/lobster/render/Lobster.v002.js';
        import { render as lobsterV003 } from '../js/entities/hero/lobster/render/Lobster.v003.js';
        import { render as lobsterV004 } from '../js/entities/hero/lobster/render/Lobster.v004.js';
        import { render as fishV001 } from '../js/entities/pickups/goldfish/render/GoldenFish.v001.js';
        import { render as fishV002 } from '../js/entities/pickups/goldfish/render/GoldenFish.v002.js';
        import { render as bubbleV001 } from '../js/entities/pickups/bubble/render/Bubble.v001.js';
        import { render as bubbleV002 } from '../js/entities/pickups/bubble/render/Bubble.v002.js';
        import { render as hookV001 } from '../js/entities/enemies/hook/render/Hook.v001.js';
        import { render as hookV002 } from '../js/entities/enemies/hook/render/Hook.v002.js';
        import { render as cageV001 } from '../js/entities/enemies/cage/render/Cage.v001.js';
        import { render as cageV002 } from '../js/entities/enemies/cage/render/Cage.v002.js';
        import { render as oceanV001 } from '../js/entities/environments/ocean/render/Ocean.v001.js';
        import { render as tankV001 } from '../js/entities/environments/tank/render/Tank.v001.js';
        import { render as kitchenV001 } from '../js/entities/environments/kitchen/render/Kitchen.v001.js';
        import { Ocean } from '../js/entities/environments/ocean/actor/Ocean.js';
        import { Tank } from '../js/entities/environments/tank/actor/Tank.js';
        import { Kitchen } from '../js/entities/environments/kitchen/actor/Kitchen.js';
        import { render as netV001 } from '../js/entities/enemies/net/render/Net.v001.js';
        import { render as forkV001 } from '../js/entities/enemies/fork/render/Fork.v001.js';
        import { render as renderMagnetism } from '../js/entities/mechanics/magnetism/render/Magnetism.js';
        import { render as renderInvincibility } from '../js/entities/mechanics/invincibility/render/Invincibility.js';
        import { render as renderDifficulty } from '../js/entities/mechanics/difficulty/render/Difficulty.js';
        import { render as renderParticle } from '../js/entities/effects/particle/render/Particle.js';
        
        const renderers = {
            'lobster-001': (c,x,y,s,t) => lobsterV001(c,x,y,s),
            'lobster-002': (c,x,y,s,t) => lobsterV002(c,x,y,s),
            'lobster-003': (c,x,y,s,t) => {
                const angle = 0;
                const segs = [];
                for (let i = 0; i < 3; i++) {
                    segs.push({ x: x - s * (0.6 + i * 0.4), y: y, angle: 0 });
                }
                lobsterV003(c, x, y, s, angle, segs, false, 0);
            },
            'lobster-004': (c,x,y,s,t) => {
                const angle = 0;
                const segs = [];
                for (let i = 0; i < 3; i++) {
                    segs.push({ x: x - s * (0.6 + i * 0.4), y: y, angle: 0 });
                }
                lobsterV004(c, x, y, s, angle, segs, false, 0);
            },
            'fish-001': (c,x,y,t,size,dir,shimmer) => fishV001(c,x,y,size||15,dir||1),
            'fish-002': (c,x,y,t,size,dir,shimmer) => fishV002(c,x,y,t,size||15,dir||1,shimmer||5),
            'bubble-001': (c,x,y,s,t,color) => bubbleV001(c,x,y,s,t,color),
            'bubble-002': (c,x,y,s,t,color) => bubbleV002(c,x,y,s,t,color),
            'hook-001': (c,x,l,t,swing) => hookV001(c,x,l),
            'hook-002': (c,x,l,t,swingSpeed) => { const hx = x + Math.sin(t * (swingSpeed || 0.03)) * 15; hookV002(c,x,hx,l); },
            'cage-001': (c,x,y,s) => cageV001(c,x,y,s),
            'cage-002': (c,x,y,s) => cageV002(c,x,y,s),
        };
        
        
        
        
        let frame = 0, params = {
            fishShimmer: 5,
            forkSize: 40,
            bubbleColor: "blue",
            magnetRadius: 80, magnetStrength: 3,
            invulnDur: 120,
            particleType: 'bubble', particleCount: 8
        };
        
        // Track selected version per entity
        const selectedVersions = {
            lobster: '004',
            fish: '001',
            bubble: '001',
            hook: '002',
            cage: '002',
            net: '001',
            fork: '001',
            particle: '001',
            ocean: 'v001',
            tank: 'v001',
            kitchen: 'v001'
        };
        
        const canvases = {};
        ['lobster','fish','hook','cage','bubble'].forEach(id => canvases[id] = document.getElementById(id+'-canvas'));
        canvases.ocean = document.getElementById('ocean-bg');
        canvases.tank = document.getElementById('tank-bg');
        canvases.kitchen = document.getElementById('kitchen-bg');
        canvases.magnet = document.getElementById('magnet-canvas');
        canvases.invincibility = document.getElementById('invincibility-canvas');
        canvases.difficulty = document.getElementById('difficulty-canvas');
        canvases.net = document.getElementById('net-canvas');
        canvases.fork = document.getElementById('fork-canvas');
        canvases.particle = document.getElementById('particle-canvas');
        
        function animate() {
            frame++;
            const c = (id) => canvases[id]?.getContext('2d');
            Object.values(canvases).forEach(cv => cv?.getContext('2d').clearRect(0,0,200,150));
            
            // Render based on selected version
            if(c('lobster')) {
                const r = renderers[`lobster-${selectedVersions.lobster}`];
                if(r) r(c('lobster'), 100, 80, ACTOR_DEFAULTS.player.size, frame);
            }
            if(c('fish')) {
                const r = renderers[`fish-${selectedVersions.fish}`];
                if(r) r(c('fish'), 100, 75, frame, ACTOR_DEFAULTS.fish.size, 1, params.fishShimmer);
            }
            if(c('hook')) {
                const r = renderers[`hook-${selectedVersions.hook}`];
                if(r) r(c('hook'), 100, ACTOR_DEFAULTS.hooks.lineLength, frame, ACTOR_DEFAULTS.hooks.swingSpeed);
            }
            if(c('cage')) {
                const r = renderers[`cage-${selectedVersions.cage}`];
                if(r) r(c('cage'), 100, 75, ACTOR_DEFAULTS.cages.size);
            }
            if(c('net')) netV001(c('net'), 100 - ACTOR_DEFAULTS.nets.width/2, 45, ACTOR_DEFAULTS.nets.width, ACTOR_DEFAULTS.nets.height);
            if(c('fork')) forkV001(c('fork'), 100, 70, params.forkSize);
            if(c('bubble')) {
                const r = renderers[`bubble-${selectedVersions.bubble}`];
                if(r) r(c('bubble'), 100, 75, ACTOR_DEFAULTS.bubbles.size, frame, params.bubbleColor);
            }
            if(c('particle')) renderParticle(c('particle'), 200, 150, frame, params.particleType, params.particleCount);
            if(c('ocean')) {
                c('ocean').fillStyle = Ocean.config.background;
                c('ocean').fillRect(0, 0, 200, 150);
                c('ocean').save();
                c('ocean').scale(200/600, 150/600);
                oceanV001(c('ocean'), 600, 600, frame * 0.5);
                c('ocean').restore();
            }
            if(c('tank')) {
                c('tank').fillStyle = Tank.config.background;
                c('tank').fillRect(0, 0, 200, 150);
                c('tank').save();
                c('tank').scale(200/600, 150/600);
                tankV001(c('tank'), 600, 600);
                c('tank').restore();
            }
            if(c('kitchen')) {
                c('kitchen').fillStyle = Kitchen.config.background;
                c('kitchen').fillRect(0, 0, 200, 150);
                c('kitchen').save();
                c('kitchen').scale(200/600, 150/600);
                kitchenV001(c('kitchen'), 600, 600);
                c('kitchen').restore();
            }
            if(c('magnet')) renderMagnetism(c('magnet'), 200, 150, frame, params.magnetRadius, params.magnetStrength);
            if(c('invincibility')) renderInvincibility(c('invincibility'), 200, 150, frame, params.invulnDur);
            if(c('difficulty')) renderDifficulty(c('difficulty'), 200, 150);
            // END MECHANICS(c('kitchen'), 200, 150, frame);
            
            requestAnimationFrame(animate);
        }
        
        // Version tab switching
        document.querySelectorAll('.version-tab').forEach(tab => {
            tab.addEventListener('click', () => {
                const card = tab.closest('.asset-card');
                const entity = card?.dataset.entity;
                const version = tab.dataset.version;
                if (entity && version) {
                    selectedVersions[entity] = version;
                    // Update tab active states
                    card.querySelectorAll('.version-tab').forEach(t => t.classList.remove('active'));
                    tab.classList.add('active');
                }
            });
        });
        // Generic param buttons (animation states, colors, etc.)
        document.querySelectorAll(".anim-btn").forEach(btn => {
            btn.addEventListener("click", () => {
                const container = btn.closest(".anim-buttons");
                // Clear active state within same button group
                container.querySelectorAll(".anim-btn").forEach(b => b.classList.remove("active"));
                btn.classList.add("active");
                // Determine which param to update
                const paramName = container.dataset.param;
                const value = btn.dataset.value || btn.dataset.anim;
                if (paramName) {
                    params[paramName] = value;
                }
            });
        });
        document.querySelectorAll('.nav a').forEach(a => a.addEventListener('click', e => {
            e.preventDefault();
            document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));
            document.getElementById(a.getAttribute('href').slice(1)).classList.add('active');
            document.querySelectorAll('.nav a').forEach(x => x.classList.remove('active'));
            a.classList.add('active');
        }));
        // Wire up ALL sliders
        const sliderConfig = [
            ['fish-shimmer', 'fishShimmer'],
            ['fork-size', 'forkSize'],
            ['magnet-radius', 'magnetRadius'],
            ['magnet-strength', 'magnetStrength'],
            ['invuln-dur', 'invulnDur'],
            ['particle-count', 'particleCount'],
        ];
        
        sliderConfig.forEach(([id, param]) => {
            const el = document.getElementById(id);
            if (el) {
                el.addEventListener('input', e => {
                    params[param] = +e.target.value;
                    const display = e.target.nextElementSibling;
                    if (display) {
                        if (id === 'invuln-dur') {
                            display.textContent = (params[param] / 60).toFixed(1) + 's';
                        } else {
                            display.textContent = e.target.value;
                        }
                    }
                });
            }
        });
        
        // Param tab switching (Render / Actor)
        document.querySelectorAll('.param-tab').forEach(tab => {
            tab.addEventListener('click', () => {
                const controls = tab.closest('.controls');
                controls.querySelectorAll('.param-tab').forEach(t => t.classList.remove('active'));
                controls.querySelectorAll('.param-pane').forEach(p => p.classList.remove('active'));
                tab.classList.add('active');
                controls.querySelector(`.param-pane[data-pane="${tab.dataset.pane}"]`).classList.add('active');
            });
        });

        // Generate actor param sliders from ENTITY_CONFIG
        const ACTOR_DEFAULTS = {
            player: { x: 400, y: 300, size: 30, speed: 5, angle: 0 },
            hooks: { x: 400, lineLength: 100, swingSpeed: 0.03, dropping: false },
            cages: { x: 400, y: 300, size: 50, baseDx: 0.75, baseDy: 0.75 },
            nets: { x: 400, y: 300, width: 80, height: 60, speed: 2 },
            forks: { x: 400, y: 300, fallSpeed: 3, wobble: 0, wobbleSpeed: 0.05, canvasHeight: 600 },
            bubbles: { x: 400, y: 300, size: 18, phase: 0 },
            fish: { x: 400, y: 300, size: 15, speed: 2, direction: 1, wobble: 0, animTime: 0 }
        };

        document.querySelectorAll('[data-actor-key]').forEach(pane => {
            const key = pane.dataset.actorKey;
            const config = ENTITY_CONFIG[key];
            const defaults = ACTOR_DEFAULTS[key];
            if (!config) return;

            for (const prop of config.props) {
                const row = document.createElement('div');
                row.className = 'control-row';
                const val = defaults[prop.key] ?? 0;

                if (prop.readOnly) {
                    row.innerHTML = `<label>${prop.key}</label>` +
                        `<span class="value" style="flex:1; text-align:left; color:#666;">${val}</span>`;
                } else {
                    row.innerHTML = `<label>${prop.key}</label>` +
                        `<input type="range" min="${prop.min}" max="${prop.max}" step="${prop.step}" value="${val}">` +
                        `<span class="value">${val}</span>`;
                    row.querySelector('input').addEventListener('input', e => {
                        const v = parseFloat(e.target.value);
                        defaults[prop.key] = v;
                        row.querySelector('.value').textContent =
                            parseFloat(e.target.step) < 1 ? v.toFixed(2) : e.target.value;
                    });
                }
                pane.appendChild(row);
            }
        });

        // Particle type selector
        document.getElementById('particle-type')?.addEventListener('change', e => {
            params.particleType = e.target.value;
        });
        
        // Music button handlers
        let currentMusic = null;
        document.querySelectorAll('.audio-btn[data-music]').forEach(btn => {
            btn.addEventListener('click', () => {
                const trackId = btn.dataset.music;
                const audio = document.getElementById(`music-${trackId}`);
                
                // Stop any currently playing music
                if (currentMusic && currentMusic !== audio) {
                    currentMusic.pause();
                    currentMusic.currentTime = 0;
                    document.querySelectorAll('.audio-btn[data-music]').forEach(b => {
                        b.textContent = '‚ñ∂ ' + b.textContent.replace('‚ñ† ', '').replace('‚ñ∂ ', '');
                    });
                }
                
                if (audio.paused) {
                    audio.play();
                    btn.textContent = '‚ñ† ' + btn.textContent.replace('‚ñ∂ ', '');
                    currentMusic = audio;
                } else {
                    audio.pause();
                    audio.currentTime = 0;
                    btn.textContent = '‚ñ∂ ' + btn.textContent.replace('‚ñ† ', '');
                    currentMusic = null;
                }
            });
        });
        
        animate();
    </script>
</body>
</html>
