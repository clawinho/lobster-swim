<!DOCTYPE html>
<html>
<head>
    <meta property="og:title" content="Lobster Swim - Arcade Survival">
    <meta property="og:description" content="Escape the kitchen. Survive the void. Play now at lobsterswim.com">
    <meta property="og:image" content="https://lobsterswim.com/assets/og-image.png">
    <meta property="og:url" content="https://lobsterswim.com">
    <meta name="twitter:card" content="summary_large_image">
    <meta charset="utf-8">
    <title>Lobster Swim ü¶û</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <link rel="stylesheet" href="css/game.css?v=1205">
</head>
<body>
        <!-- TITLE SCREEN -->
    <div id="title-screen">
        <!-- Sprite decorations -->
        <img src="assets/sprites/hook-sprite.png" class="title-sprite hook-left" alt="">
        <img src="assets/sprites/hook-sprite.png" class="title-sprite hook-right" alt="">
        <img src="assets/sprites/cage-sprite.png" class="title-sprite cage-left" alt="">
        <img src="assets/sprites/cage-sprite.png" class="title-sprite cage-right" alt="">
        <img src="assets/sprites/bubbles-sprite.png" class="title-sprite bubbles-1" alt="">
        <img src="assets/sprites/bubbles-sprite.png" class="title-sprite bubbles-2" alt="">
        <img src="assets/sprites/fish-sprite.png" class="title-sprite fish-1" alt="">
        <img src="assets/sprites/fish-sprite.png" class="title-sprite fish-2" alt="">
        <img src="assets/sprites/bubbles-sprite.png" class="title-sprite bubbles-3" alt="">
        <img src="assets/sprites/bubbles-sprite.png" class="title-sprite bubbles-4" alt="">
        <img src="assets/sprites/fish-sprite.png" class="title-sprite fish-3" alt="">
        <img src="assets/sprites/bubbles-sprite.png" class="title-sprite bubbles-5" alt="">
        <img src="assets/sprites/bubbles-sprite.png" class="title-sprite bubbles-6" alt="">
        <img src="assets/sprites/bubbles-sprite.png" class="title-sprite bubbles-7" alt="">
        <img src="assets/sprites/bubbles-sprite.png" class="title-sprite bubbles-8" alt="">
        <img src="assets/sprites/bubbles-sprite.png" class="title-sprite bubbles-9" alt="">
        <img src="assets/sprites/bubbles-sprite.png" class="title-sprite bubbles-10" alt="">
        <img src="assets/sprites/bubbles-sprite.png" class="title-sprite bubbles-11" alt="">
        <img src="assets/sprites/bubbles-sprite.png" class="title-sprite bubbles-12" alt="">

        <!-- Main content -->
        <div id="title-content">
            <img src="assets/sprites/title-text.png" id="title-logo" alt="Lobster Swim">
            <img src="assets/sprites/lobster-sprite.png" id="title-lobster-img" alt="Lobster">
            <p id="title-tagline">Escape the kitchen. Survive the void.</p>
            <div id="title-highscore">High Score: <span id="title-hs">0</span></div>
            <button id="play-btn">‚ñ∂ PLAY</button>
            <p id="title-hint">üéµ Arrow keys or touch to swim</p>
        </div>
    </div>

    <!-- LEADERBOARD -->
    <div id="leaderboard">
        <div class="leaderboard-title">üèÜ TOP SCORES</div>
        <div id="scores-list">Loading...</div>
    </div>

    <!-- GAME OVER MODAL -->
    <div id="name-input">
        <div class="modal-icon">ü¶ûüíÄ</div>
        <div class="modal-title">GAME OVER</div>
        <div id="death-quote">"The void claims all eventually..."</div>
        <div class="final-score">Final Score: <span id="final-score-display">0</span></div>
        <div class="input-label">Enter your name:</div>
        <input type="text" id="player-name" maxlength="15" placeholder="Your name">
        <div class="modal-buttons">
            <button id="submit-score-btn">SUBMIT</button>
            <button id="skip-btn">SKIP</button>
        </div>
    </div>

    <!-- GAME UI -->
    <div id="ui">
        <h1>ü¶û Lobster Swim</h1>
        <p>Score: <span id="score">0</span> | <span id="lives">‚ù§Ô∏è‚ù§Ô∏è‚ù§Ô∏è</span><span id="difficulty"></span> <span id="level-name"></span></p>
        <p id="mobile-hint">Use joystick below or tap to swim!</p>
    </div>

    <!-- DEV PANEL -->
    <div id="dev-panel" style="position: fixed; top: 0; left: 50%; transform: translateX(-50%); width: 800px; max-width: 100%; background: #001820ee; border: 2px solid #ff4500; border-top: none; padding: 8px 15px; display: none; flex-direction: column; z-index: 100; font-size: 12px; font-family: monospace;">
        <div style="color: #ff4500; font-weight: bold; margin-bottom: 6px;">üîß DEV MODE</div>
        <div style="display: flex; flex-direction: row; flex-wrap: wrap; align-items: center; gap: 5px;">
            <button id="pause-btn" onclick="devTogglePause()" style="background:#001820ee; color:#ff4500; border:2px solid #ff4500; padding:5px 12px; font-family:monospace; font-size:12px; font-weight:bold; cursor:pointer;">‚è∏ PAUSE</button>
            <button onclick="devSetLevel(1)" style="background: #224; color: #fff; border: 1px solid #448; padding: 5px; cursor: pointer;">Level 1: Ocean</button>
            <button onclick="devSetLevel(2)" style="background: #224; color: #fff; border: 1px solid #448; padding: 5px; cursor: pointer;">Level 2: Tank</button>
            <button onclick="devSetLevel(3)" style="background: #224; color: #fff; border: 1px solid #448; padding: 5px; cursor: pointer;">Level 3: Kitchen</button>
            <button onclick="devAddScore(100)" style="background: #242; color: #fff; border: 1px solid #484; padding: 5px; cursor: pointer;">+100 Score</button>
            <button onclick="devAddScore(500)" style="background: #242; color: #fff; border: 1px solid #484; padding: 5px; cursor: pointer;">+500 Score</button>
            <button onclick="devToggleGod()" id="god-btn" style="background: #422; color: #fff; border: 1px solid #844; padding: 5px; cursor: pointer;">God Mode: OFF</button>
            <button onclick="devSpawnFish()" style="background: #442; color: #fff; border: 1px solid #884; padding: 5px; cursor: pointer;">Spawn Fish üêü</button>
            <button onclick="devAddLife()" style="background: #442; color: #fff; border: 1px solid #884; padding: 5px; cursor: pointer;">+1 Life ‚ù§Ô∏è</button>
            <button onclick="devRemoveLife()" style="background: #442; color: #fff; border: 1px solid #884; padding: 5px; cursor: pointer;">-1 Life üíî</button>
            <button onclick="toggleDevPanel()" style="background: #333; color: #888; border: 1px solid #555; padding: 5px; cursor: pointer;">Close</button>
        </div>
    </div>

    <!-- GAME CANVAS -->
    <canvas id="game" width="800" height="600"></canvas>

    <!-- MOBILE JOYSTICK -->
    <div id="joystick-zone">
        <div id="joystick-base">
            <div id="joystick-knob"></div>
        </div>
    </div>

    <!-- CONTROLS -->
    <button id="music-btn">üéµ</button>
    <button id="sfx-btn">üí•</button>

    <!-- BOTTOM NAV -->
    <bottom-nav version="1.0.50"></bottom-nav>

    <!-- Dev panel toggle -->
    <script>
        let devPanelOpen = false;
        function toggleDevPanel() {
            devPanelOpen = !devPanelOpen;
            document.getElementById('dev-panel').style.display = devPanelOpen ? 'flex' : 'none';
            if (!devPanelOpen) {
                // Closing dev panel: unpause and hide inspector
                window.gameDevSelectedEntities = [];
                window.gameDevSetPaused?.(false);
                document.getElementById('pause-btn').textContent = '‚è∏ PAUSE';
                document.querySelector('entity-inspector')?.hide();
                document.querySelector('entity-outliner')?.hide();
            } else {
                // Opening dev panel: auto-pause and show inspector + outliner
                window.gameDevSetPaused?.(true);
                document.getElementById('pause-btn').textContent = '‚ñ∂ RESUME';
                document.querySelector('entity-inspector')?.show();
                document.querySelector('entity-outliner')?.show();
            }
        }

        function devTogglePause() {
            const isPaused = window.gameDevIsPaused?.();
            const nowPaused = !isPaused;
            window.gameDevSetPaused?.(nowPaused);
            document.getElementById('pause-btn').textContent = nowPaused ? '‚ñ∂ RESUME' : '‚è∏ PAUSE';
            const inspector = document.querySelector('entity-inspector');
            const outliner = document.querySelector('entity-outliner');
            if (nowPaused) { inspector?.show(); outliner?.show(); } else { inspector?.hide(); outliner?.hide(); }
        }

        // Listen for version click from bottom-nav component
        document.addEventListener('version-click', toggleDevPanel);

        // P key toggles pause when dev panel is open
        document.addEventListener('keydown', (e) => {
            if (e.key === 'p' || e.key === 'P') {
                if (devPanelOpen && !e.target.matches('input, textarea')) {
                    devTogglePause();
                }
            }
        });

        // Dev functions - these call into the game module
        function devSetLevel(lvl) { window.gameDevSetLevel?.(lvl); }
        function devAddScore(pts) { window.gameDevAddScore?.(pts); }
        function devToggleGod() {
            const isGod = window.gameDevToggleGod?.();
            document.getElementById('god-btn').textContent = 'God Mode: ' + (isGod ? 'ON' : 'OFF');
        }
        function devSpawnFish() { window.gameDevSpawnFish?.(); }
        function devAddLife() { window.gameDevAddLife?.(); }
        function devRemoveLife() { window.gameDevRemoveLife?.(); }

        // Canvas click: pick entity in dev mode (supports Ctrl/Shift multi-select)
        document.getElementById('game').addEventListener('click', (e) => {
            if (!devPanelOpen) return;
            const el = document.getElementById('game');
            const rect = el.getBoundingClientRect();
            const scaleX = el.width / rect.width;
            const scaleY = el.height / rect.height;
            const cx = (e.clientX - rect.left) * scaleX;
            const cy = (e.clientY - rect.top) * scaleY;
            const hit = window.gameDevPickEntityAt?.(cx, cy);

            if (e.ctrlKey || e.metaKey) {
                if (hit) {
                    const sels = window.gameDevSelectedEntities;
                    const exists = sels.some(s => s.key === hit.key && s.index === hit.index);
                    if (exists) {
                        window.gameDevSelectedEntities = sels.filter(s => !(s.key === hit.key && s.index === hit.index));
                    } else {
                        window.gameDevSelectedEntities = [...sels, hit];
                    }
                    window._gameDevLastSelected = hit;
                }
            } else if (e.shiftKey && window._gameDevLastSelected && hit) {
                const anchor = window._gameDevLastSelected;
                if (anchor.key === hit.key && anchor.index !== null && hit.index !== null) {
                    const lo = Math.min(anchor.index, hit.index);
                    const hi = Math.max(anchor.index, hit.index);
                    const range = [];
                    for (let i = lo; i <= hi; i++) range.push({ key: hit.key, index: i });
                    const existing = window.gameDevSelectedEntities.filter(s => s.key !== hit.key);
                    window.gameDevSelectedEntities = [...existing, ...range];
                } else if (hit) {
                    window.gameDevSelectedEntities = [...window.gameDevSelectedEntities, hit];
                }
                window._gameDevLastSelected = hit;
            } else {
                window.gameDevSelectedEntities = hit ? [hit] : [];
                window._gameDevLastSelected = hit;
            }
        });
    </script>

    <!-- Entity Outliner (left) + Entity Inspector (right) -->
    <entity-outliner></entity-outliner>
    <entity-inspector></entity-inspector>

    <!-- Load components and game -->
    <script type="module" src="js/components/BottomNav.js?v=1010"></script>
    <script type="module" src="js/components/EntityInspector.js?v=1010"></script>
    <script type="module" src="js/components/EntityOutliner.js?v=1010"></script>
    <script type="module" src="js/app.js?v=1010"></script>
</body>
</html>
