var fe=Object.defineProperty;var de=(t,e,s)=>e in t?fe(t,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[e]=s;var E=(t,e,s)=>de(t,typeof e!="symbol"?e+"":e,s);(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))i(n);new MutationObserver(n=>{for(const a of n)if(a.type==="childList")for(const o of a.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&i(o)}).observe(document,{childList:!0,subtree:!0});function s(n){const a={};return n.integrity&&(a.integrity=n.integrity),n.referrerPolicy&&(a.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?a.credentials="include":n.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function i(n){if(n.ep)return;n.ep=!0;const a=s(n);fetch(n.href,a)}})();class ue extends HTMLElement{constructor(){super(),this.attachShadow({mode:"open"})}connectedCallback(){const e=this.getAttribute("version")||"1.0.0",s=window.location.pathname,i=s==="/"||s==="/index.html"||s.endsWith("/src/"),n=s.includes("commits"),a=s.includes("assets"),o=s.includes("roadmap");this.shadowRoot.innerHTML=`
            <style>
                :host {
                    position: fixed;
                    bottom: 10px;
                    right: 15px;
                    display: flex;
                    align-items: center;
                    gap: 10px;
                    font-family: monospace;
                    z-index: 1000;
                }
                
                .version {
                    cursor: pointer;
                    font-size: 10px;
                    color: #ff4500aa;
                    transition: all 0.2s;
                }
                
                .version:hover {
                    transform: scale(1.1);
                    color: #ff4500;
                }
                
                .nav-links {
                    display: flex;
                    gap: 8px;
                    align-items: center;
                }
                
                .nav-links a {
                    text-decoration: none;
                    padding: 6px 12px;
                    border-radius: 4px;
                    font-size: 13px;
                    transition: all 0.2s;
                }
                
                .nav-links a.game {
                    color: #ff4500;
                    background: #ff450011;
                    border: 1px solid #ff450044;
                }
                
                .nav-links a.game:hover,
                .nav-links a.game.active {
                    background: #ff450033;
                    border-color: #ff4500;
                }
                
                .nav-links a.commits {
                    color: #4488ff;
                    background: #4488ff11;
                    border: 1px solid #4488ff44;
                }
                
                .nav-links a.commits:hover,
                .nav-links a.commits.active {
                    background: #4488ff33;
                    border-color: #4488ff;
                }
                
                .nav-links a.assets {
                    color: #ffaa00;
                    background: #ffaa0011;
                    border: 1px solid #ffaa0044;
                }
                
                .nav-links a.assets:hover,
                .nav-links a.assets.active {
                    background: #ffaa0033;
                    border-color: #ffaa00;
                }
                
                .nav-links a.roadmap {
                    color: #88ff88;
                    background: #88ff8811;
                    border: 1px solid #88ff8844;
                }
                
                .nav-links a.roadmap:hover,
                .nav-links a.roadmap.active {
                    background: #88ff8833;
                    border-color: #88ff88;
                }
                
                /* Mobile */
                @media (max-width: 600px) {
                    :host {
                        flex-direction: column;
                        align-items: flex-end;
                        gap: 8px;
                    }
                    
                    .nav-links {
                        flex-direction: column;
                        gap: 8px;
                        align-items: flex-end;
                    }
                }
                
                /* Large screens */
                @media (min-width: 1400px) {
                    :host {
                        font-size: 14px;
                        padding: 8px 12px;
                        background: #001820aa;
                        border: 1px solid #ff450044;
                        border-radius: 4px;
                    }
                    
                    .version { font-size: 14px; }
                }
                
                @media (min-width: 2000px) {
                    :host {
                        font-size: 18px;
                        padding: 12px 20px;
                        gap: 15px;
                    }
                    
                    .version { font-size: 16px; }
                    .nav-links a { font-size: 16px; padding: 8px 16px; }
                }
            </style>
            
            <div class="version" id="version-click">v${e}</div>
            <div class="nav-links">
                <a href="/" class="game ${i?"active":""}">ðŸ¦ž play</a>
                <a href="/pages/commits.html" class="commits ${n?"active":""}">commits</a>
                <a href="/pages/assets.html" class="assets ${a?"active":""}">assets</a>
                <a href="/pages/roadmap.html" class="roadmap ${o?"active":""}">roadmap</a>
            </div>
        `,this.shadowRoot.querySelector(".version").addEventListener("click",()=>{this.dispatchEvent(new CustomEvent("version-click",{bubbles:!0,composed:!0}))})}}customElements.define("bottom-nav",ue);function me(t,e,s,i,n,a,o,h){o&&Math.floor(h/5)%2===0&&(t.globalAlpha=.4);const c=Math.sin(Date.now()/300)*.3;t.fillStyle="#cc3300";for(let u=0;u<2;u++){const I=i*(.5-u*.12);t.save(),t.translate(a[u].x,a[u].y),t.rotate(a[u].angle),t.beginPath(),t.ellipse(0,0,I,I*.7,c*(u+1),0,Math.PI*2),t.fill(),t.restore()}t.fillStyle="#ff4500",t.save(),t.translate(a[2].x,a[2].y),t.rotate(a[2].angle);for(let u=-2;u<=2;u++)t.beginPath(),t.ellipse(-8,u*4,8,3,c*3,0,Math.PI*2),t.fill();t.restore(),t.save(),t.translate(e,s),t.rotate(n),t.fillStyle="#ff4500",t.beginPath(),t.ellipse(0,0,i,i*.6,0,0,Math.PI*2),t.fill();let f=Math.sin(Date.now()/200)*.15;t.save(),t.rotate(-.5+f),t.fillStyle="#ff4500",t.beginPath(),t.ellipse(i*.9,-i*.1,i*.5,i*.25,.3,0,Math.PI*2),t.fill(),t.fillStyle="#cc3300",t.beginPath(),t.moveTo(i*1.3,-i*.2),t.lineTo(i*1.6,-i*.4),t.lineTo(i*1.6,0),t.closePath(),t.fill(),t.restore(),t.save(),t.rotate(.5-f),t.fillStyle="#ff4500",t.beginPath(),t.ellipse(i*.9,i*.1,i*.5,i*.25,-.3,0,Math.PI*2),t.fill(),t.fillStyle="#cc3300",t.beginPath(),t.moveTo(i*1.3,i*.2),t.lineTo(i*1.6,i*.4),t.lineTo(i*1.6,0),t.closePath(),t.fill(),t.restore(),t.fillStyle="#000",t.beginPath(),t.arc(i*.3,-i*.2,4,0,Math.PI*2),t.arc(i*.3,i*.2,4,0,Math.PI*2),t.fill(),t.fillStyle="#fff",t.beginPath(),t.arc(i*.32,-i*.22,1.5,0,Math.PI*2),t.arc(i*.32,i*.18,1.5,0,Math.PI*2),t.fill(),t.strokeStyle="#ff6600",t.lineWidth=2;let d=Math.sin(Date.now()/150)*5;t.beginPath(),t.moveTo(i*.5,-i*.3),t.quadraticCurveTo(i*.8,-i*.8+d,i*1.2,-i*.6+d),t.stroke(),t.beginPath(),t.moveTo(i*.5,i*.3),t.quadraticCurveTo(i*.8,i*.8-d,i*1.2,i*.6-d),t.stroke(),t.lineWidth=1,t.restore(),t.globalAlpha=1,o&&(t.strokeStyle="#ffff0066",t.lineWidth=3,t.beginPath(),t.arc(e,s,i+10,0,Math.PI*2),t.stroke(),t.lineWidth=1)}const x=class x{constructor(e=400,s=300,i=30,n=5){this.x=e,this.y=s,this.size=i,this.speed=n,this.targetX=e,this.targetY=s,this.angle=0,this.prevX=e,this.prevY=s,this.tailSegments=[];for(let a=0;a<x.TAIL_SEGMENTS;a++)this.tailSegments.push({x:e,y:s,angle:0})}reset(e=400,s=300){this.x=e,this.y=s,this.targetX=e,this.targetY=s,this.angle=0,this.prevX=e,this.prevY=s,this.tailSegments.forEach(i=>{i.x=e,i.y=s,i.angle=0})}update(e,s,i){if((e.ArrowUp||e.w||e.W)&&(this.y-=this.speed),(e.ArrowDown||e.s||e.S)&&(this.y+=this.speed),(e.ArrowLeft||e.a||e.A)&&(this.x-=this.speed),(e.ArrowRight||e.d||e.D)&&(this.x+=this.speed),s&&(s.dx!==0||s.dy!==0)&&(this.x+=s.dx*this.speed,this.y+=s.dy*this.speed),i){let n=this.targetX-this.x,a=this.targetY-this.y,o=Math.sqrt(n*n+a*a);return o>10?(this.x+=n/o*this.speed,this.y+=a/o*this.speed,!0):!1}return!1}clamp(e,s){this.x=Math.max(this.size,Math.min(e-this.size,this.x)),this.y=Math.max(this.size,Math.min(s-this.size,this.y))}updateAngle(){let e=this.x-this.prevX,s=this.y-this.prevY;if(Math.abs(e)>.5||Math.abs(s)>.5){let n=Math.atan2(s,e)-this.angle;for(;n>Math.PI;)n-=Math.PI*2;for(;n<-Math.PI;)n+=Math.PI*2;this.angle+=n*.1}this.prevX=this.x,this.prevY=this.y}updateTail(){let e={x:this.x,y:this.y,angle:this.angle};for(let s=0;s<this.tailSegments.length;s++){let i=this.tailSegments[s],n=e.x-Math.cos(e.angle)*(this.size*.5),a=e.y-Math.sin(e.angle)*(this.size*.5);i.x+=(n-i.x)*x.TAIL_FOLLOW_SPEED,i.y+=(a-i.y)*x.TAIL_FOLLOW_SPEED;let o=e.x-i.x,h=e.y-i.y;if(Math.abs(o)>.1||Math.abs(h)>.1){let f=Math.atan2(h,o)-i.angle;for(;f>Math.PI;)f-=Math.PI*2;for(;f<-Math.PI;)f+=Math.PI*2;i.angle+=f*.2}e=i}}render(e,s=!1,i=0){this.updateAngle(),this.updateTail(),me(e,this.x,this.y,this.size,this.angle,this.tailSegments,s,i)}getBounds(){return{x:this.x-this.size,y:this.y-this.size,width:this.size*2,height:this.size*2,centerX:this.x,centerY:this.y,radius:this.size}}};E(x,"TAIL_SEGMENTS",3),E(x,"TAIL_FOLLOW_SPEED",.15);let It=x;function pe(t,e,s,i){t.strokeStyle="#666",t.lineWidth=2,t.beginPath(),t.moveTo(e,0),t.lineTo(s,i-15),t.stroke(),t.strokeStyle="#ccc",t.lineWidth=3,t.beginPath(),t.moveTo(s,i-15),t.lineTo(s,i),t.arc(s-8,i,8,0,Math.PI,!1),t.stroke(),t.fillStyle="#fff",t.beginPath(),t.moveTo(s-16,i),t.lineTo(s-22,i-6),t.lineTo(s-14,i-2),t.fill(),t.lineWidth=1}class vt{constructor(e,s=150,i=.02){this.x=e,this.lineLength=s,this.angle=Math.random()*Math.PI*2,this.swingSpeed=i,this.dropping=!1,this.dropSpeed=0,this.originalLineLength=s}static create(e,s=2,i={}){const n=[];for(let a=0;a<s;a++){const o=Math.random()*(e-200)+100,h=i.lineLength||Math.random()*100+100,c=i.swingSpeed||.015+Math.random()*.02;n.push(new vt(o,h,c))}return n}update(e=1){this.dropping?(this.dropSpeed+=.5,this.lineLength+=this.dropSpeed,this.lineLength>500&&(this.dropping=!1,this.lineLength=this.originalLineLength,this.dropSpeed=0)):this.angle+=this.swingSpeed*e}drop(){this.dropping||(this.dropping=!0,this.dropSpeed=2)}getHookPosition(){const e=Math.sin(this.angle)*50;return{x:this.x+e-10,y:this.lineLength,radius:20}}render(e){const s=Math.sin(this.angle)*50;pe(e,this.x,this.x+s,this.lineLength)}checkCollision(e,s=!1){if(s)return!1;const i=this.getHookPosition(),n=e.x-i.x,a=e.y-i.y;return Math.sqrt(n*n+a*a)<e.size+i.radius}}function ge(t,e,s,i){t.save(),t.translate(e,s);const n=i*1.8,a=i*1.2;t.fillStyle="#1a0a0066",t.fillRect(-n/2,-a/2,n,a),t.strokeStyle="#8B4513",t.lineWidth=3,t.strokeRect(-n/2,-a/2,n,a),t.lineWidth=2,t.strokeStyle="#666";for(let o=-n/2+n/5;o<n/2;o+=n/5)t.beginPath(),t.moveTo(o,-a/2),t.lineTo(o,a/2),t.stroke();t.beginPath(),t.moveTo(-n/2,0),t.lineTo(n/2,0),t.stroke(),t.strokeStyle="#8B4513",t.beginPath(),t.moveTo(n/2,-a/3),t.lineTo(n/4,0),t.lineTo(n/2,a/3),t.stroke(),t.restore()}class $t{constructor(e,s,i=40){this.x=e,this.y=s,this.size=i,this.baseDx=(Math.random()-.5)*1.5,this.baseDy=(Math.random()-.5)*1.5}static create(e=2,s=800,i=600){const n=[];for(let a=0;a<e;a++){const o=Math.random()*(s-100),h=Math.random()*(i-100);n.push(new $t(o,h,40))}return n}update(e=1,s=800,i=600){this.x+=this.baseDx*e,this.y+=this.baseDy*e,(this.x<0||this.x>s)&&(this.baseDx*=-1),(this.y<0||this.y>i)&&(this.baseDy*=-1),this.x=Math.max(0,Math.min(s,this.x)),this.y=Math.max(0,Math.min(i,this.y))}render(e){ge(e,this.x,this.y,this.size)}getBounds(){const e=this.size*1.8,s=this.size*1.2;return{x:this.x-e/2,y:this.y-s/2,width:e,height:s,centerX:this.x,centerY:this.y}}checkCollision(e,s=!1){if(s)return!1;this.getBounds();const i=e.x-this.x,n=e.y-this.y;return Math.sqrt(i*i+n*n)<e.size+this.size*.8}}function ye(t,e,s,i=100,n=60){t.strokeStyle="#446688",t.lineWidth=2;for(let a=0;a<=4;a++)t.beginPath(),t.moveTo(e,s+a*n/4),t.lineTo(e+i,s+a*n/4),t.stroke();for(let a=0;a<=5;a++)t.beginPath(),t.moveTo(e+a*(i/5),s),t.lineTo(e+a*(i/5),s+n),t.stroke();t.strokeStyle="#886644",t.lineWidth=4,t.beginPath(),t.moveTo(e+i/2,s),t.lineTo(e+i/2,s-30),t.stroke(),t.lineWidth=1}class St{constructor(e,s,i=100,n=60){this.x=e,this.y=s,this.width=i,this.height=n,this.speed=Math.random()>.5?2:-2}static create(e=2,s=800,i=600){const n=[];for(let a=0;a<e;a++){const o=Math.random()>.5?-100:s,h=Math.random()*(i-100)+50;n.push(new St(o,h,100,60))}return n}update(e=1,s=800,i=600){this.x+=this.speed*e,this.x<-150&&(this.x=s+50,this.y=Math.random()*(i-100)+50),this.x>s+100&&(this.x=-100,this.y=Math.random()*(i-100)+50)}render(e){ye(e,this.x,this.y,this.width,this.height)}getBounds(){return{x:this.x,y:this.y,width:this.width,height:this.height,centerX:this.x+this.width/2,centerY:this.y+this.height/2}}checkCollision(e,s=!1){return s?!1:e.x+e.size>this.x&&e.x-e.size<this.x+this.width&&e.y+e.size>this.y&&e.y-e.size<this.y+this.height}}function Me(t,e,s,i=40){const n=i/40;t.fillStyle="#8B4513",t.fillRect(e-4*n,s-50*n,8*n,50*n),t.fillStyle="#c0c0c0";for(let a=-1;a<=1;a++)t.beginPath(),t.moveTo(e+a*10*n-3*n,s),t.lineTo(e+a*10*n+3*n,s),t.lineTo(e+a*10*n+1*n,s+35*n),t.lineTo(e+a*10*n-1*n,s+35*n),t.closePath(),t.fill();t.fillStyle="#ffffff44",t.fillRect(e-2*n,s,2*n,30*n)}class Et{constructor(e,s=600){this.x=e,this.y=-50,this.fallSpeed=2+Math.random()*2,this.wobble=Math.random()*Math.PI*2,this.wobbleSpeed=.05+Math.random()*.05,this.canvasHeight=s}static create(e=3,s=800,i=600){const n=[];for(let a=0;a<e;a++){const o=Math.random()*(s-100)+50,h=new Et(o,i);h.y=-50-a*150,n.push(h)}return n}update(e=1,s=800,i=600){this.y+=this.fallSpeed*e,this.wobble+=this.wobbleSpeed,this.x+=Math.sin(this.wobble)*.5,this.y>i+100&&(this.y=-50-Math.random()*100,this.x=Math.random()*(s-100)+50,this.fallSpeed=2+Math.random()*2),this.x=Math.max(50,Math.min(s-50,this.x))}render(e){Me(e,this.x,this.y)}getBounds(){return{x:this.x-15,y:this.y-50,width:30,height:85,centerX:this.x,centerY:this.y}}checkCollision(e,s=!1){if(s)return!1;const i=Math.abs(e.x-this.x),n=e.y-this.y;return i<20&&n>-10&&n<40}}const Te={blue:210,pink:320,green:140,gold:45};function R(t,e,s,i){e/=100,s/=100;const n=o=>(o+t/30)%12,a=o=>s-e*Math.min(s,1-s)*Math.max(-1,Math.min(n(o)-3,Math.min(9-n(o),1)));return`rgba(${Math.round(a(0)*255)}, ${Math.round(a(8)*255)}, ${Math.round(a(4)*255)}, ${i})`}function be(t,e=210){return typeof t=="number"?t:Te[t]??e}function ve(t,e,s,i,n,a="blue",o=!1){const h=be(a),c=Math.sin(n*.1)*2,f=s+c,d=t.createRadialGradient(e-i*.3,f-i*.3,0,e,f,i);o?(d.addColorStop(0,R(h,80,88,.95)),d.addColorStop(.5,R(h,85,65,.7)),d.addColorStop(1,R(h,75,45,.4))):(d.addColorStop(0,R(h,70,80,.9)),d.addColorStop(.5,R(h,80,58,.5)),d.addColorStop(1,R(h,70,35,.3))),t.fillStyle=d,t.beginPath(),t.arc(e,f,i,0,Math.PI*2),t.fill(),t.fillStyle="rgba(255,255,255,0.8)",t.beginPath(),t.arc(e-i*.3,f-i*.3,i*.2,0,Math.PI*2),t.fill(),o&&(t.strokeStyle=R(h,70,70,.4),t.lineWidth=2,t.beginPath(),t.arc(e,f,i+3,0,Math.PI*2),t.stroke(),t.lineWidth=1)}const w=class w{constructor(e,s,i=18){this.x=e,this.y=s,this.size=i,this.phase=Math.random()*Math.PI*2}static create(e=8,s=800,i=600){const n=[];for(let a=0;a<e;a++){const o=Math.random()*(s-50)+25,h=Math.random()*(i-50)+25;n.push(new w(o,h,18))}return n}respawn(e=800,s=600){this.x=Math.random()*(e-50)+25,this.y=Math.random()*(s-50)+25,this.phase=Math.random()*Math.PI*2}update(e,s){const i=e-this.x,n=s-this.y,a=Math.sqrt(i*i+n*n);if(a<w.MAGNET_RADIUS&&a>5){const o=1-a/w.MAGNET_RADIUS;return this.x+=i/a*w.MAGNET_STRENGTH*o,this.y+=n/a*w.MAGNET_STRENGTH*o,!0}return!1}render(e,s,i){const n=s-this.x,a=i-this.y,h=Math.sqrt(n*n+a*a)<w.MAGNET_RADIUS,c=Date.now()*.01+this.phase*100;ve(e,this.x,this.y,this.size,c,w.color,h)}checkCollision(e){const s=e.x-this.x,i=e.y-this.y;return Math.sqrt(s*s+i*i)<e.size+this.size}};E(w,"MAGNET_RADIUS",80),E(w,"MAGNET_STRENGTH",3),E(w,"color","pink");let At=w;function Se(t,e,s,i,n=15,a=1,o=5){const h=Math.sin(i*.1)*5;t.save(),t.translate(e+h,s),t.scale(a,1),t.fillStyle="#ffff0044";for(let f=0;f<o;f++){const d=Math.sin(i*.1+f*1.5)*25,u=Math.cos(i*.13+f)*15;t.beginPath(),t.arc(d,u,2+Math.sin(i*.2+f),0,Math.PI*2),t.fill()}const c=t.createRadialGradient(0,0,0,0,0,n);c.addColorStop(0,"#ffdd00"),c.addColorStop(1,"#ff8800"),t.fillStyle=c,t.beginPath(),t.ellipse(0,0,n,n*.6,0,0,Math.PI*2),t.fill(),t.fillStyle="#ffaa00",t.save(),t.rotate(Math.sin(i*.4)*.3),t.beginPath(),t.moveTo(-n,0),t.lineTo(-n*1.8,-n*.6),t.lineTo(-n*1.8,n*.6),t.closePath(),t.fill(),t.restore(),t.fillStyle="#000",t.beginPath(),t.arc(n*.5,-n*.1,3,0,Math.PI*2),t.fill(),t.fillStyle="#fff",t.beginPath(),t.arc(n*.55,-n*.15,1.5,0,Math.PI*2),t.fill(),t.restore()}const X=class X{constructor(e=800){this.size=15,this.speed=2,this.direction=Math.random()>.5?1:-1,this.x=this.direction>0?-30:e+30,this.y=Math.random()*400+100,this.wobble=0,this.animTime=Math.random()*1e3}update(e,s,i=800){this.animTime++;const n=this.x-e,a=this.y-s,o=Math.sqrt(n*n+a*a);return o<100?(this.x+=n/o*this.speed*1.2,this.y+=a/o*this.speed*.6,this.direction=n>0?1:-1):(this.wobble+=.1,this.x+=this.direction*this.speed*.5,this.y+=Math.sin(this.wobble)*1.5),this.y<50&&(this.y=50),this.y>550&&(this.y=550),this.x<-50||this.x>i+50}render(e){Se(e,this.x,this.y,this.animTime,this.size,this.direction,X.SHIMMER_COUNT)}checkCollision(e){const s=e.x-this.x,i=e.y-this.y;return Math.sqrt(s*s+i*i)<e.size+this.size}};E(X,"SPAWN_INTERVAL",300),E(X,"SPAWN_CHANCE",.02),E(X,"SHIMMER_COUNT",5);let U=X;function Ee(t,e,s,i=0,n=20){const a=i*.05,o=.5+Math.sin(a*2)*.3,h=t.createRadialGradient(e,s,0,e,s,n*2);h.addColorStop(0,`rgba(255, 255, 200, ${o*.4})`),h.addColorStop(.5,`rgba(255, 200, 255, ${o*.2})`),h.addColorStop(1,"rgba(255, 255, 255, 0)"),t.fillStyle=h,t.beginPath(),t.arc(e,s,n*2,0,Math.PI*2),t.fill(),t.save(),t.translate(e,s);const c=Math.sin(a)*.15+.3;t.fillStyle="#8b7355",t.beginPath(),t.ellipse(0,n*.3,n*1.2,n*.6,0,0,Math.PI),t.fill(),t.strokeStyle="#6b5344",t.lineWidth=2,t.stroke();for(let S=-3;S<=3;S++)t.beginPath(),t.moveTo(S*n*.3,n*.3),t.lineTo(S*n*.2,n*.8),t.strokeStyle="rgba(107, 83, 68, 0.5)",t.lineWidth=1,t.stroke();t.save(),t.translate(0,-n*.1),t.rotate(-c),t.fillStyle="#9b8365",t.beginPath(),t.ellipse(0,-n*.2,n*1.1,n*.5,0,Math.PI,Math.PI*2),t.fill(),t.strokeStyle="#7b6354",t.lineWidth=2,t.stroke(),t.restore();const f=-n*.1,d=n*.5,u=t.createRadialGradient(e-d*.3,f-d*.3,0,0,f,d);u.addColorStop(0,"#ffffff"),u.addColorStop(.3,"#ffeef8"),u.addColorStop(.6,"#e0d0e8"),u.addColorStop(1,"#c0b0d0"),t.fillStyle=u,t.beginPath(),t.arc(0,f,d,0,Math.PI*2),t.fill();const I=a*3;t.fillStyle=`rgba(255, 255, 255, ${.6+Math.sin(I)*.3})`,t.beginPath(),t.arc(-d*.3,f-d*.3,d*.25,0,Math.PI*2),t.fill();const rt=i*2%360;t.fillStyle=R(rt,50,70,.2),t.beginPath(),t.arc(d*.2,f+d*.2,d*.3,0,Math.PI*2),t.fill(),t.restore();for(let S=0;S<3;S++){const lt=a*2+S*(Math.PI*2/3),Ut=n*1.5+Math.sin(a*3+S)*5,le=Math.cos(lt)*Ut,he=Math.sin(lt)*Ut*.6,ce=.5+Math.sin(a*4+S*2)*.4;t.fillStyle=`rgba(255, 255, 200, ${ce})`,t.beginPath(),t.arc(e+le,s+he,2,0,Math.PI*2),t.fill()}}class we{constructor(e,s){this.x=e,this.y=s,this.size=25,this.time=Math.random()*100,this.active=!0,this.bobOffset=Math.random()*Math.PI*2,this.vy=-.3,this.vx=(Math.random()-.5)*.5}update(){this.time++,this.y+=this.vy+Math.sin(this.time*.02+this.bobOffset)*.3,this.x+=this.vx,(this.y<-50||this.x<-50||this.x>850)&&(this.active=!1)}render(e){this.active&&Ee(e,this.x,this.y,this.time,this.size)}getHitbox(){return{x:this.x-this.size*.5,y:this.y-this.size*.5,width:this.size,height:this.size}}}class O{constructor(e,s,i,n,a,o,h,c=0){this.x=e,this.y=s,this.vx=i,this.vy=n,this.color=a,this.size=o,this.life=h,this.maxLife=h,this.gravity=c}update(){return this.x+=this.vx,this.y+=this.vy,this.vy+=this.gravity,this.vx*=.98,this.vy*=.98,this.life--,this.life>0}render(e){const s=this.life/this.maxLife;e.save(),e.globalAlpha=s,e.fillStyle=this.color,e.shadowColor=this.color,e.shadowBlur=10,e.beginPath(),e.arc(this.x,this.y,this.size*s,0,Math.PI*2),e.fill(),e.restore()}static spawnBubbleParticles(e,s,i=8){const n=[],a=["#88ddff","#aaeeff","#ffffff","#66ccff"];for(let o=0;o<i;o++){const h=Math.PI*2*o/i+Math.random()*.5,c=2+Math.random()*2;n.push(new O(e,s,Math.cos(h)*c,Math.sin(h)*c-1,a[Math.floor(Math.random()*a.length)],3+Math.random()*2,30+Math.random()*20,-.05))}return n}static spawnDeathParticles(e,s,i=20){const n=[],a=["#ff4500","#ff6600","#ff8800","#ffaa00"];for(let o=0;o<i;o++){const h=Math.random()*Math.PI*2,c=3+Math.random()*4;n.push(new O(e,s,Math.cos(h)*c,Math.sin(h)*c,a[Math.floor(Math.random()*a.length)],4+Math.random()*3,40+Math.random()*20,.1))}return n}static spawnGoldenParticles(e,s,i=12){const n=[],a=["#ffd700","#ffec00","#fff8dc","#fffacd"];for(let o=0;o<i;o++){const h=Math.PI*2*o/i,c=2+Math.random()*3;n.push(new O(e,s,Math.cos(h)*c,Math.sin(h)*c-2,a[Math.floor(Math.random()*a.length)],4+Math.random()*2,50+Math.random()*20,-.03))}return n}}class Pe{constructor(){this.ctx=null,this.musicEnabled=!0,this.sfxEnabled=!0,this.currentTrack=null,this.currentTrackPath=null}init(){return this.ctx||(this.ctx=new(window.AudioContext||window.webkitAudioContext)),this.ctx.state==="suspended"&&this.ctx.resume(),this.ctx}startLevelMusic(e){this.musicEnabled&&(this.currentTrackPath===e&&this.currentTrack||(this.stopMusic(),this.currentTrackPath=e,e&&(this.currentTrack=new window.Audio(e),this.currentTrack.loop=!0,this.currentTrack.volume=1,this.currentTrack.play().catch(()=>{}))))}stopMusic(){this.currentTrack&&(this.currentTrack.pause(),this.currentTrack.currentTime=0,this.currentTrack=null)}toggleMusic(){return this.musicEnabled=!this.musicEnabled,this.musicEnabled&&this.currentTrackPath?this.startLevelMusic(this.currentTrackPath):this.stopMusic(),this.musicEnabled}toggleSfx(){return this.sfxEnabled=!this.sfxEnabled,this.sfxEnabled}playBloop(){if(!this.sfxEnabled)return;this.init();const e=this.ctx.createOscillator(),s=this.ctx.createGain();e.connect(s),s.connect(this.ctx.destination),e.frequency.setValueAtTime(600,this.ctx.currentTime),e.frequency.exponentialRampToValueAtTime(1200,this.ctx.currentTime+.1),s.gain.setValueAtTime(.3,this.ctx.currentTime),s.gain.exponentialRampToValueAtTime(.01,this.ctx.currentTime+.1),e.start(this.ctx.currentTime),e.stop(this.ctx.currentTime+.1)}playHit(){if(!this.sfxEnabled)return;this.init();const e=this.ctx.createOscillator(),s=this.ctx.createGain();e.connect(s),s.connect(this.ctx.destination),e.type="sawtooth",e.frequency.setValueAtTime(200,this.ctx.currentTime),e.frequency.exponentialRampToValueAtTime(50,this.ctx.currentTime+.2),s.gain.setValueAtTime(.4,this.ctx.currentTime),s.gain.exponentialRampToValueAtTime(.01,this.ctx.currentTime+.2),e.start(this.ctx.currentTime),e.stop(this.ctx.currentTime+.2)}playDeath(){if(!this.sfxEnabled)return;this.init();const e=this.ctx.createOscillator(),s=this.ctx.createGain();e.connect(s),s.connect(this.ctx.destination),e.type="sawtooth",e.frequency.setValueAtTime(400,this.ctx.currentTime),e.frequency.exponentialRampToValueAtTime(30,this.ctx.currentTime+.5),s.gain.setValueAtTime(.5,this.ctx.currentTime),s.gain.exponentialRampToValueAtTime(.01,this.ctx.currentTime+.5),e.start(this.ctx.currentTime),e.stop(this.ctx.currentTime+.5)}playExtraLife(){if(!this.sfxEnabled)return;this.init(),[523,659,784,1047].forEach((s,i)=>{const n=this.ctx.createOscillator(),a=this.ctx.createGain();n.connect(a),a.connect(this.ctx.destination),n.frequency.setValueAtTime(s,this.ctx.currentTime+i*.1),a.gain.setValueAtTime(.3,this.ctx.currentTime+i*.1),a.gain.exponentialRampToValueAtTime(.01,this.ctx.currentTime+i*.1+.15),n.start(this.ctx.currentTime+i*.1),n.stop(this.ctx.currentTime+i*.1+.15)})}playHooked(){if(!this.sfxEnabled)return;this.init();const e=this.ctx.createOscillator(),s=this.ctx.createGain();e.connect(s),s.connect(this.ctx.destination),e.type="triangle",e.frequency.setValueAtTime(800,this.ctx.currentTime),e.frequency.exponentialRampToValueAtTime(100,this.ctx.currentTime+.8),s.gain.setValueAtTime(.4,this.ctx.currentTime),s.gain.linearRampToValueAtTime(.01,this.ctx.currentTime+.8),e.start(this.ctx.currentTime),e.stop(this.ctx.currentTime+.8)}playLevelUp(){if(!this.sfxEnabled)return;this.init(),[392,494,587,784].forEach((s,i)=>{const n=this.ctx.createOscillator(),a=this.ctx.createGain();n.connect(a),a.connect(this.ctx.destination),n.type="triangle",n.frequency.setValueAtTime(s,this.ctx.currentTime+i*.15),a.gain.setValueAtTime(.4,this.ctx.currentTime+i*.15),a.gain.exponentialRampToValueAtTime(.01,this.ctx.currentTime+i*.15+.2),n.start(this.ctx.currentTime+i*.15),n.stop(this.ctx.currentTime+i*.15+.2)})}}function ke(t,e,s,i,n,a){t.save(),t.globalAlpha=.15+Math.sin(i*.001)*.05,t.strokeStyle="#4488aa",t.lineWidth=2;for(let c=0;c<8;c++){const f=(i*n*.5+c*(e/8))%(e+60)-60,d=s*.2+c%3*s*.3,u=Math.sin(i*.002+c)*30;t.beginPath(),t.moveTo(f,d+u);const I=f+Math.cos(a)*60,rt=d+u+Math.sin(a)*60,S=(f+I)/2,lt=(d+u+rt)/2+Math.sin(i*.003+c*.5)*10;t.quadraticCurveTo(S,lt,I,rt),t.stroke()}t.restore()}class Ie{constructor(e=.3){this.baseStrength=e,this.angle=Math.random()*Math.PI*2,this.targetAngle=this.angle,this.strength=e,this.time=0,this.changeTimer=0,this.changeInterval=300}update(e=1){this.time++,this.changeTimer++,this.changeTimer>=this.changeInterval&&(this.changeTimer=0,this.targetAngle=Math.random()*Math.PI*2,this.strength=this.baseStrength*(.8+Math.random()*.4));let i=(this.targetAngle-this.angle+Math.PI*3)%(Math.PI*2)-Math.PI;return this.angle+=i*.02,{dx:Math.cos(this.angle)*this.strength*e,dy:Math.sin(this.angle)*this.strength*e}}applyToPlayer(e,s=1,i=800,n=600){const a=this.update(s);return e.x+=a.dx,e.y+=a.dy,e.x=Math.max(e.size,Math.min(i-e.size,e.x)),e.y=Math.max(e.size,Math.min(n-e.size,e.y)),a}render(e,s,i){ke(e,s,i,this.time,this.strength,this.angle)}getInfo(){return{angle:this.angle,angleDeg:this.angle*180/Math.PI%360,strength:this.strength,direction:this.getDirectionName()}}getDirectionName(){const e=(this.angle*180/Math.PI%360+360)%360;return e<22.5||e>=337.5?"East":e<67.5?"Southeast":e<112.5?"South":e<157.5?"Southwest":e<202.5?"West":e<247.5?"Northwest":e<292.5?"North":"Northeast"}}function Ae(t,e,s,i){t.fillStyle="#3d2817",t.fillRect(0,500,e,100),t.fillStyle="#2d5a2d";for(let n=0;n<8;n++){const a=(n*120+i*.2)%(e+100)-50;for(let o=0;o<5;o++){const h=Math.sin(Date.now()/500+n+o)*10;t.beginPath(),t.ellipse(a+h,520-o*30,8,25,.2+h*.02,0,Math.PI*2),t.fill()}}}const Mt=class Mt{renderBackground(e,s,i,n){e.fillStyle=Mt.config.background,e.fillRect(0,0,s,i),Ae(e,s,i,n)}};E(Mt,"config",{name:"The Ocean",subtitle:null,background:"#001020",scoreThreshold:0,musicTrack:"assets/music/music_ocean.mp3",enemies:{hooks:2},spawnOnEnter:{},mechanics:["oceanCurrent"]});let Lt=Mt;function Le(t,e,s){t.fillStyle="#4a4a4a",t.fillRect(0,520,e,80),t.fillStyle="#666",t.fillRect(30,450,60,70),t.fillStyle="#888",t.beginPath(),t.moveTo(30,450),t.lineTo(60,420),t.lineTo(90,450),t.fill()}const Tt=class Tt{renderBackground(e,s,i,n){e.fillStyle=Tt.config.background,e.fillRect(0,0,s,i),Le(e,s)}};E(Tt,"config",{name:"Seafood Tank",subtitle:"Captured... but not defeated",background:"#002030",scoreThreshold:200,musicTrack:"assets/music/music_tank.mp3",enemies:{hooks:2,nets:2},spawnOnEnter:{nets:2},mechanics:[]});let Ct=Tt;function Ce(t,e,s){t.fillStyle="#8B4513",t.fillRect(0,500,e,100),t.strokeStyle="#ffffff22";for(let i=0;i<e;i+=50)t.beginPath(),t.moveTo(i,0),t.lineTo(i,500),t.stroke();for(let i=0;i<500;i+=50)t.beginPath(),t.moveTo(0,i),t.lineTo(e,i),t.stroke()}const bt=class bt{renderBackground(e,s,i,n){e.fillStyle=bt.config.background,e.fillRect(0,0,s,i),Ce(e,s)}};E(bt,"config",{name:"The Kitchen",subtitle:"Escape the pot or become dinner",background:"#1a0a05",scoreThreshold:500,musicTrack:"assets/music/music_kitchen.mp3",enemies:{hooks:2,nets:2,forks:3},spawnOnEnter:{forks:3},mechanics:[]});let Dt=bt;const m=800,g=600,xt=120,Qt=[new Lt,new Ct,new Dt],P=Object.fromEntries(Qt.map((t,e)=>[e+1,t.constructor.config])),Q={THRESHOLDS:[100,200,500,1e3],SPEED_MULT:[1,1.2,1.4,1.6,2],HOOK_COUNTS:[2,2,3,3,4],TIER_NAMES:["","WARM","MEDIUM","HARD","HELL"]},_t=["The void claims all eventually...","Even the mightiest lobster falls...","The kitchen always wins...","Butter and garlic await...","Another one for the pot..."],Zt=90,De=10,Ft=["","Nice!","Great!","Awesome!","Amazing!","INCREDIBLE!","UNSTOPPABLE!","GODLIKE!","LEGENDARY!","TRANSCENDENT!"];let k,r,p,l,Wt,z,Yt,F,j,T,M,nt,Bt=null,v=0,q=3,H=0,K=!1,B=!1,J=0,V=!1,N=0,wt=0,Pt=!1,D=0,tt=0,y=0,W=0,et=[],$=[],_=0,Ot="#ffff00";const Be=[5,8,10],Oe={5:"#ffff00",8:"#ff8800",10:"#ff00ff"};let C=1,L=!0,G=xt,it=!1,ht=0,Y=0,b={},pt=0,gt=0,at=!1,zt=0,Rt=0,ct=0,ft=0,A=[],Gt,te,Nt,ee,qt,Ht,dt,Vt,ie,ot,se,ne;function Re(){k=document.getElementById("game"),r=k.getContext("2d"),p=new Pe,Gt=document.getElementById("title-screen"),te=document.getElementById("play-btn"),Nt=document.getElementById("score"),ee=document.getElementById("lives"),qt=document.getElementById("level-name"),Ht=document.getElementById("difficulty"),dt=document.getElementById("scores-list"),Vt=document.getElementById("name-input"),ie=document.getElementById("final-score-display"),ot=document.getElementById("player-name"),se=document.getElementById("submit-score-btn"),ne=document.getElementById("skip-btn"),H=parseInt(localStorage.getItem("lobsterHighScore")||"0"),document.getElementById("title-hs").textContent=H,Ne(),Xt(),console.log("ðŸ¦ž Lobster Swim initialized")}function Ne(){te.addEventListener("click",$e),document.addEventListener("keydown",e=>b[e.key]=!0),document.addEventListener("keyup",e=>b[e.key]=!1);let t=!1;k.addEventListener("mousedown",e=>{t=!0,jt(e)}),document.addEventListener("mouseup",()=>{t=!1}),k.addEventListener("mousemove",e=>{t&&jt(e)}),k.addEventListener("touchstart",Kt,{passive:!1}),k.addEventListener("touchmove",Kt,{passive:!1}),He(),document.getElementById("music-btn").addEventListener("click",()=>{const e=p.toggleMusic();document.getElementById("music-btn").style.opacity=e?"0.8":"0.4"}),document.getElementById("sfx-btn").addEventListener("click",()=>{const e=p.toggleSfx();document.getElementById("sfx-btn").style.opacity=e?"0.8":"0.4"}),se.addEventListener("click",Jt),ne.addEventListener("click",re),ot.addEventListener("keypress",e=>{e.key==="Enter"&&Jt()})}function He(){const t=document.getElementById("joystick-base"),e=document.getElementById("joystick-knob");if(!t||!e)return;let s=!1;const i=(n,a)=>{const o=t.getBoundingClientRect(),h=o.left+o.width/2,c=o.top+o.height/2,f=o.width/2-25;let d=n-h,u=a-c;const I=Math.sqrt(d*d+u*u);I>f&&(d=d/I*f,u=u/I*f),e.style.transform=`translate(calc(-50% + ${d}px), calc(-50% + ${u}px))`,pt=d/f,gt=u/f};t.addEventListener("touchstart",n=>{n.preventDefault(),s=!0,i(n.touches[0].clientX,n.touches[0].clientY)},{passive:!1}),document.addEventListener("touchmove",n=>{s&&n.touches.length>0&&i(n.touches[0].clientX,n.touches[0].clientY)},{passive:!1}),document.addEventListener("touchend",()=>{s=!1,e.style.transform="translate(-50%, -50%)",pt=0,gt=0})}function jt(t){if(!B||K)return;const e=k.getBoundingClientRect(),s=k.width/e.width,i=k.height/e.height;l.targetX=(t.clientX-e.left)*s,l.targetY=(t.clientY-e.top)*i,at=!0}function Kt(t){if(!B||K)return;t.preventDefault();const e=t.touches[0],s=k.getBoundingClientRect(),i=k.width/s.width,n=k.height/s.height;l.targetX=(e.clientX-s.left)*i,l.targetY=(e.clientY-s.top)*n,at=!0}async function $e(){try{Bt=(await(await fetch("/api/scores/start")).json()).session}catch{Bt=null}Gt.classList.add("hidden"),p.init(),p.startLevelMusic(P[1].musicTrack),v=0,q=3,K=!1,B=!0,C=1,L=!0,G=xt,it=!1,Rt=0,ct=0,A=[],V=!1,N=0,wt=0,J=0,Pt=!1,D=0,tt=0,y=0,W=0,et=[],$=[],_=0,l=new It(400,300),Wt=At.create(8,m,g),Yt=$t.create(2,m,g),z=vt.create(m,2),F=[],j=[],T=null,M=null,ft=0,nt=new Ie(.4),qe(),oe()}function ut(){let t=0;for(let e=0;e<Q.THRESHOLDS.length;e++)v>=Q.THRESHOLDS[e]&&(t=e+1);return{tier:t,name:Q.TIER_NAMES[t],speedMult:Q.SPEED_MULT[t],hookCount:Q.HOOK_COUNTS[t]}}function ae(){for(let t=3;t>=1;t--){const e=P[t];if(v>=e.scoreThreshold&&C<t){C=t,document.body.style.background=e.background,qt.textContent=e.name;const s=e.spawnOnEnter;s.nets&&(F=St.create(s.nets,m,g)),s.forks&&(j=Et.create(s.forks,m,g)),p.startLevelMusic(e.musicTrack),p.playLevelUp(),Pt=!0,D=120,tt=t;break}}}function xe(){return y<=1?1:1+(y-1)*.5}function st(){return y<=1?"#00ffff":y<=3?"#00ff00":y<=5?"#ffff00":y<=7?"#ff8800":"#ff00ff"}function mt(){A.push(...O.spawnDeathParticles(l.x,l.y)),Y=12,q--,y=0,W=0,kt(),q<=0?(p.playDeath(),V=!0,N=120,wt=0,Y=20,l.x=m/2,l.y=g/3,v>H&&(H=v,localStorage.setItem("lobsterHighScore",H.toString()),J=180)):(p.playHit(),l.reset(400,300),at=!1,it=!1,L=!0,G=xt)}function We(){var e,s;if(K)return;if(V){N--,wt+=.15,l.y+=1.5,l.x+=Math.sin(N*.1)*2,N%8===0&&A.push(...O.spawnDeathParticles(l.x,l.y).slice(0,2)),N<=0&&(V=!1,K=!0,Ve()),A=A.filter(i=>i.update());return}J>0&&J--,D>0&&(D--,D<=0&&(Pt=!1)),W>0&&(W--,W<=0&&(y=0)),_>0&&_--,et=et.filter(i=>(i.timer--,i.y-=1.5,i.timer>0)),$=$.filter(i=>(i.timer--,i.y-=2,i.timer>0));const t=ut();if(L&&(G--,G<=0&&(L=!1)),it){ht-=3,l.y=ht,l.y<-50&&mt();return}if((b.ArrowUp||b.w||b.W)&&(l.y-=l.speed),(b.ArrowDown||b.s||b.S)&&(l.y+=l.speed),(b.ArrowLeft||b.a||b.A)&&(l.x-=l.speed),(b.ArrowRight||b.d||b.D)&&(l.x+=l.speed),(pt!==0||gt!==0)&&(l.x+=pt*l.speed,l.y+=gt*l.speed),at){const i=l.targetX-l.x,n=l.targetY-l.y,a=Math.sqrt(i*i+n*n);a>10?(l.x+=i/a*l.speed,l.y+=n/a*l.speed):at=!1}if(P[C].mechanics.includes("oceanCurrent")&&nt){const i=ut();nt.applyToPlayer(l,i.speedMult,m,g)}if(l.clamp(m,g),Wt.forEach(i=>{if(i.update(l.x,l.y),i.checkCollision(l)){A.push(...O.spawnBubbleParticles(i.x,i.y)),p.playBloop(),y=Math.min(y+1,De),W=Zt,Be.includes(y)&&(_=20,Ot=Oe[y],Y=Math.min(8,y));const n=xe(),o=Math.floor(10*n);if(v+=o,$.push({x:i.x,y:i.y,text:"+"+o,timer:45,color:y>1?st():"#00ffff",startY:i.y}),y>1){const c=Ft[Math.min(y,Ft.length-1)];et.push({x:i.x,y:i.y,text:`${n}x ${c}`,timer:60,color:st()})}i.respawn(m,g),yt(),ut().hookCount>z.length&&v>Rt+100&&(z.push(...vt.create(m,1)),Rt=v)}}),Yt.forEach(i=>{i.update(t.speedMult,m,g),i.checkCollision(l,L)&&(it=!0,ht=l.y,p.playHooked())}),z.forEach(i=>{i.update(t.speedMult);const n=i.getHookPosition();Math.abs(l.x-n.x)<80&&l.y>n.y&&!i.dropping&&Math.random()<.003*t.speedMult&&i.drop(),i.checkCollision(l,L)&&(it=!0,ht=l.y,p.playHooked())}),P[C].enemies.nets&&F.forEach(i=>{i.update(t.speedMult,m,g),i.checkCollision(l,L)&&mt()}),P[C].enemies.forks&&j.forEach(i=>{i.update(t.speedMult,m,g),i.checkCollision(l,L)&&mt()}),ct++,!T&&ct>U.SPAWN_INTERVAL&&q<3&&Math.random()<U.SPAWN_CHANCE&&(T=new U(m),ct=0),T&&(T.update(l.x,l.y,m)?T=null:T.checkCollision(l)&&(A.push(...O.spawnGoldenParticles(T.x,T.y)),p.playExtraLife(),q++,v+=50,$.push({x:T.x,y:T.y,text:"+50 +â¤ï¸",timer:60,color:"#ffd700",startY:T.y}),kt(),yt(),T=null)),ft++,!M&&ft>1200&&Math.random()<.2&&(M=new we(Math.random()*(m-100)+50,g+30),ft=0),M)if(M.update(),!M.active)M=null;else{const i=M.getHitbox(),n=l.x,a=l.y,o=20,h=Math.max(i.x,Math.min(n,i.x+i.width)),c=Math.max(i.y,Math.min(a,i.y+i.height));Math.sqrt((n-h)**2+(a-c)**2)<o&&((e=p.playPowerup)!=null&&e.call(p)||((s=p.playBubble)==null||s.call(p)),L=!0,G=300,$.push({x:M.x,y:M.y,text:"âœ¨ SHIELD! âœ¨",timer:90,color:"#ff88ff",startY:M.y}),A.push(...O.spawnGoldenParticles(M.x,M.y)),M=null)}ae(),zt+=.5,A=A.filter(i=>i.update())}function Ye(){if(r.save(),Y>0){const t=(Math.random()-.5)*Y*2,e=(Math.random()-.5)*Y*2;r.translate(t,e),Y--}if(Ge(),P[C].mechanics.includes("oceanCurrent")&&nt&&nt.render(r,m,g),Wt.forEach(t=>t.render(r,l.x,l.y)),Yt.forEach(t=>t.render(r)),z.forEach(t=>t.render(r)),P[C].enemies.nets&&F.forEach(t=>t.render(r)),P[C].enemies.forks&&j.forEach(t=>t.render(r)),T&&T.render(r),M&&M.render(r),V?(r.save(),r.translate(l.x,l.y),r.rotate(wt),r.translate(-l.x,-l.y),l.render(r,!1,0),r.restore(),N>75&&(r.fillStyle=`rgba(255, 0, 0, ${(N-75)/15*.3})`,r.fillRect(0,0,m,g))):l.render(r,L,G),A.forEach(t=>t.render(r)),$.forEach(t=>{const e=Math.min(1,t.timer/15),s=(45-t.timer)*.8;r.save(),r.globalAlpha=e,r.font="bold 18px monospace",r.textAlign="center",r.fillStyle=t.color,r.shadowColor="#000",r.shadowBlur=4,r.fillText(t.text,t.x,t.startY-s),r.restore()}),et.forEach(t=>{const e=Math.min(1,t.timer/20),s=1+(60-t.timer)*.01;r.save(),r.globalAlpha=e,r.font=`bold ${16*s}px monospace`,r.textAlign="center",r.fillStyle=t.color,r.shadowColor=t.color,r.shadowBlur=10,r.fillText(t.text,t.x,t.y),r.restore()}),y>1&&!V){r.save();const t=150,e=8,s=m/2-t/2,i=15,n=W/Zt;r.fillStyle="rgba(0, 0, 0, 0.5)",r.fillRect(s-2,i-2,t+4,e+4),r.fillStyle=st(),r.fillRect(s,i,t*n,e),r.font="bold 14px monospace",r.textAlign="center",r.fillStyle=st(),r.shadowColor=st(),r.shadowBlur=8,r.fillText(`${y}x COMBO`,m/2,i+25),r.restore()}if(_>0){const t=_/20*.4;r.fillStyle=Ot.replace(")",`, ${t})`).replace("rgb","rgba").replace("#","");const e=Ot,s=parseInt(e.slice(1,3),16),i=parseInt(e.slice(3,5),16),n=parseInt(e.slice(5,7),16);r.fillStyle=`rgba(${s}, ${i}, ${n}, ${t})`,r.fillRect(0,0,m,g)}if(J>0){const t=1+Math.sin(J*.2)*.1;r.save(),r.font=`bold ${36*t}px monospace`,r.textAlign="center",r.fillStyle="#00ff00",r.shadowColor="#00ff00",r.shadowBlur=20,r.fillText("âœ¨ NEW BEST! âœ¨",m/2,80),r.restore()}if(Pt&&D>0){if(r.save(),D>100){const a=(D-100)/20*.8;r.fillStyle=`rgba(255, 255, 255, ${Math.min(a,.8)})`,r.fillRect(0,0,m,g)}const t=1-D/120,e=t<.2?t/.2:1,s=t>.7?1-(t-.7)/.3:1,i=e*s;r.globalAlpha=i,r.textAlign="center";const n=1+Math.sin(D*.15)*.05;r.font=`bold ${48*n}px monospace`,r.fillStyle="#fff",r.shadowColor="#ff4500",r.shadowBlur=30,r.fillText(P[tt].name.toUpperCase(),m/2,g/2-20),P[tt].subtitle&&(r.font="18px monospace",r.shadowBlur=10,r.fillStyle="#ffaa00",r.fillText(P[tt].subtitle,m/2,g/2+25)),r.restore()}r.restore()}function Ge(){Qt[C-1].renderBackground(r,m,g,zt)}function oe(){B&&(We(),Ye(),(!K||V)&&requestAnimationFrame(oe))}function qe(){yt(),kt(),qt.textContent=""}function yt(){H>0?Nt.innerHTML=`${v} <span style="color:#888;font-size:0.8em">(Best: ${H})</span>`:Nt.textContent=v;const t=ut();t.name?Ht.textContent=`[${t.name}]`:Ht.textContent=""}function kt(){let t="";for(let e=0;e<3;e++)t+=e<q?"â¤ï¸":"ðŸ–¤";ee.innerHTML=t}function Ve(){const t=_t[Math.floor(Math.random()*_t.length)];document.getElementById("death-quote").textContent=`"${t}"`,ie.textContent=v,ot.value=localStorage.getItem("lobsterPlayerName")||"",Vt.style.display="block",setTimeout(()=>ot.focus(),100)}async function Jt(){const t=ot.value.trim()||"Anonymous";localStorage.setItem("lobsterPlayerName",t);try{await fetch("/api/scores",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:t,score:v,session:Bt})}),Xt()}catch(e){console.error("Failed to submit score:",e)}re()}function re(){Vt.style.display="none",p.stopMusic(),B=!1,document.getElementById("title-hs").textContent=H,Gt.classList.remove("hidden"),Xt()}async function Xt(){try{const e=await(await fetch("/api/scores")).json(),i=window.innerWidth<=820?5:10,n=e.slice(0,i);if(n.length===0){dt.innerHTML="No scores yet!";return}dt.innerHTML=n.map((a,o)=>`<div>${o+1}. ${Xe(a.name)}: ${a.score}</div>`).join("")}catch{dt.innerHTML="Could not load scores"}}function Xe(t){const e=document.createElement("div");return e.textContent=t,e.innerHTML}document.addEventListener("DOMContentLoaded",Re);let Z=!1;window.gameDevSetLevel=t=>{if(!B)return;const e=P[t];e&&(C=t,document.body.style.background=e.background,document.getElementById("level-name").textContent=e.name,e.enemies.nets&&F.length===0&&(F=St.create(e.enemies.nets,m,g)),e.enemies.forks&&j.length===0&&(j=Et.create(e.enemies.forks,m,g)),p.startLevelMusic(e.musicTrack))};window.gameDevAddScore=t=>{B&&(v+=t,yt(),ae())};window.gameDevToggleGod=()=>(Z=!Z,L=Z,Z&&(G=999999),Z);window.gameDevSpawnFish=()=>{B&&(T=new U(m))};window.gameDevAddLife=()=>{B&&(q++,kt())};window.gameDevRemoveLife=()=>{B&&mt()};
